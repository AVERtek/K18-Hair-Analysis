<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>K18 AR Experience</title>

    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KT4SXZW');</script>

    <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.js"></script>
    
    <style> 
        body { background-color: #00BBB4; margin: 0; padding: 15px; font-family: -apple-system, Helvetica, Arial, sans-serif; }
        .container { column-count: 2; column-width: 400px; column-gap: 20px; }
        .card { break-inside: avoid; background-color: #00BBB4; border: 2px solid #00BBB9; padding: 10px; margin-bottom: 1.5em; position: relative; }
        .card-white { break-inside: avoid; background-color: #FFFFFF; border: 2px solid #00BBB9; padding: 10px; margin-bottom: 1.5em; }
        .marginauto { margin: 10px auto; display: block; }
        .center-content { text-align: center; color: #FFFFFF; }
        
        /* AR Button Styling */
        .ar-button { 
            background-color: #ff595a; border-radius: 8px; border: 1px solid white; 
            position: absolute; top: 15px; right: 15px; height: 42px; 
            color: white; padding: 0 15px; cursor: pointer; z-index: 10;
            font-weight: bold;
        }

        /* Action Buttons */
        .action-btn {
            background-color: #ff595a; border-radius: 8px; border: 1px solid white; 
            height: 40px; color: white; padding: 0 20px; cursor: pointer; 
            text-transform: uppercase; font-weight: bold; margin: 5px;
        }

        model-viewer { width: 100%; height: 500px; --poster-color: transparent; }
    </style>
</head>

<body>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KT4SXZW" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

    <div class="container">
        
        <div class="card">
            <img class="marginauto" src="images/K18_Logo_White.png" alt="K18 Logo" style="height: 80px; width: auto;"> 
        </div>

        <div class="card">
            <model-viewer id="ar-interaction" 
                src="Models/AR_57seconds_withoutBanner.glb"
                ios-src="Models/AR_57seconds_withoutBanner_WithAudioEN.usdz"
                ar ar-modes="webxr scene-viewer quick-look" 
                ar-preferred 
                camera-controls
                autoplay
                alt="K18 AR Experience">
                
                <button slot="ar-button" class="ar-button">
                    ðŸ‘† AR CLICK HERE
                </button>
            </model-viewer>
        </div>

        <div class="card center-content">
            <h3 style="margin-bottom: 10px;">LISTEN TO NARRATION</h3>
            <audio controls id="main-audio" style="width: 100%;">
                <source src="Sound/K18 VOICE.mp3" type="audio/mpeg">
            </audio>
        </div>

        <div class="card-white">
            <model-viewer id="sync-model" 
                src="Models/K18_TEST_Ver.5.glb" 
                camera-controls 
                interaction-prompt="none" 
                autoplay
                style="height: 500px;">
            </model-viewer>
        </div>

        <div class="center-content">   
            <button class="action-btn" onclick="location.href='https://avertek.github.io/K18-Hair-Analysis-espanol/'">
                EN ESPAÃ‘OL
            </button> 
        </div>

        <div class="card">
            <img class="marginauto" src="images/K18 Symbology Sheet 8final750c.png" style="width: 100%; height: auto;"> 
        </div>

        <div class="card center-content">
            <h4>CAN'T GET ENOUGH?</h4>
            <button class="action-btn" onclick="window.open('https://www.k18hair.com/pages/our-science')">How K18 Works</button> 
            <button class="action-btn" onclick="window.open('https://www.instagram.com/k18hair/?hl=en')">Join Our Crusade</button> 
        </div>

        <div class="card center-content">
            <p style="font-size: 12px; opacity: 0.8;">If AR button does not appear on mobile, try another browser.</p>
            <a href="https://avertek.net/" style="color: white; font-size: 14px;">Powered by AVERtek's XR-NOW</a>
        </div>

    </div>

    <script>
        const modelViewer = document.querySelector("#sync-model");
        const audio = document.querySelector("#main-audio");

        // Ensure the model starts playing as soon as it's finished loading
        modelViewer.addEventListener('load', () => {
            console.log("3D Model Loaded");
            modelViewer.play();
        });

        // Sync 3D animation time to Audio time
        audio.addEventListener("timeupdate", () => {
            // We set the model's current time to match the audio
            modelViewer.currentTime = audio.currentTime;
        });

        // Sync Play/Pause states
        audio.addEventListener("play", () => {
            modelViewer.play();
        });

        audio.addEventListener("pause", () => {
            modelViewer.pause();
        });

        // Fix for "Autoplay" restrictions: Start audio/animation on first user click
        document.body.addEventListener('click', () => {
            if (audio.paused) {
                audio.play().catch(e => console.log("Audio waiting for interaction"));
                modelViewer.play();
            }
        }, { once: true });
    </script>
</body>
</html>
