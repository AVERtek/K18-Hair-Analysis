<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>K18 AR Experience</title>

    <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.js"></script>
    
    <style> 
        body { background-color: #00BBB4; margin: 0; padding: 15px; font-family: -apple-system, Helvetica, Arial, sans-serif; }
        .container { column-count: 2; column-width: 400px; column-gap: 20px; }
        .card { break-inside: avoid; background-color: #00BBB4; border: 2px solid #00BBB9; padding: 10px; margin-bottom: 1.5em; position: relative; }
        .card-white { break-inside: avoid; background-color: #FFFFFF; border: 2px solid #00BBB9; padding: 10px; margin-bottom: 1.5em; position: relative; }
        
        /* The Overlay Play Button */
        #overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 100;
            display: flex; justify-content: center; align-items: center;
            border-radius: 8px; cursor: pointer;
        }
        #overlay.hide { display: none; }
        .play-trigger { background: #ff595a; color: white; border: 2px solid white; padding: 15px 30px; border-radius: 50px; font-weight: bold; font-size: 1.2em; }

        .ar-button { 
            background-color: #ff595a; border-radius: 8px; border: 1px solid white; 
            position: absolute; top: 15px; right: 15px; height: 42px; 
            color: white; padding: 0 15px; cursor: pointer; z-index: 10;
        }

        .action-btn {
            background-color: #ff595a; border-radius: 8px; border: 1px solid white; 
            height: 40px; color: white; padding: 0 20px; cursor: pointer; margin: 5px;
        }

        model-viewer { width: 100%; height: 500px; }
    </style>
</head>

<body>
    <div class="container">
        <div class="card">
            <img style="margin: 10px auto; display: block; height: 80px;" src="images/K18_Logo_White.png"> 
        </div>

        <div class="card">
            <model-viewer id="interaction" src="Models/AR_57seconds_withoutBanner.glb"
                ios-src="Models/AR_57seconds_withoutBanner_WithAudioEN.usdz"
                ar ar-modes="webxr scene-viewer quick-look" ar-preferred camera-controls>
                <button slot="ar-button" class="ar-button">ðŸ‘† AR CLICK HERE</button>
            </model-viewer>
        </div>

        <div class="card-white">
            <div id="overlay" onclick="startExperience()">
                <div class="play-trigger">CLICK TO START EXPERIENCE</div>
            </div>

            <model-viewer id="sync-model" 
                src="Models/K18_TEST_Ver.5.glb" 
                camera-controls 
                interaction-prompt="none">
            </model-viewer>
        </div>

        <div class="card" style="text-align: center;">
            <h3 style="color: white;">NARRATION</h3>
            <audio id="main-audio" style="width: 100%;" controls>
                <source src="Sound/K18 VOICE.mp3" type="audio/mpeg">
            </audio>
        </div>

        <div style="text-align: center; margin-bottom: 20px;">   
            <button class="action-btn" onclick="location.href='https://avertek.github.io/K18-Hair-Analysis-espanol/'">EN ESPAÃ‘OL</button> 
        </div>

        <div class="card">
            <img src="images/K18 Symbology Sheet 8final750c.png" style="width: 100%;"> 
        </div>
    </div>

    <script>
        const modelViewer = document.querySelector("#sync-model");
        const audio = document.querySelector("#main-audio");
        const overlay = document.querySelector("#overlay");

        // Function triggered by the Overlay Button
        function startExperience() {
            // Hide the overlay
            overlay.classList.add("hide");
            
            // Start both simultaneously
            audio.play();
            modelViewer.play();
            
            console.log("Experience Started");
        }

        // KEEP THEM SYNCED DURING PLAYBACK
        audio.addEventListener("timeupdate", () => {
            // Force the 3D model to follow the audio's exact timestamp
            if (!isNaN(audio.currentTime)) {
                modelViewer.currentTime = audio.currentTime;
            }
        });

        // If user pauses the audio using the player bar, pause the model
        audio.addEventListener("pause", () => {
            modelViewer.pause();
        });

        // If user resumes the audio, resume the model
        audio.addEventListener("play", () => {
            modelViewer.play();
        });

        // Optional: Ensure model is loaded before allowing play
        modelViewer.addEventListener('load', () => {
            console.log("Model loaded and ready for sync.");
        });
    </script>
</body>
</html>
